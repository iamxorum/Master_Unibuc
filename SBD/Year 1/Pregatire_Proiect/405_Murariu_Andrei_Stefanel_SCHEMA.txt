-- Oracle docker - sysdba
CREATE USER ddsys IDENTIFIED BY 'password';

GRANT CONNECT, RESOURCE TO ddsys;

SELECT username FROM all_users WHERE username = 'DDSYS';

GRANT CREATE USER TO ddsys;
GRANT CREATE TABLESPACE TO ddsys;
GRANT UNLIMITED TABLESPACE TO ddsys;
GRANT CREATE SESSION TO ddsys;
GRANT CREATE TABLE TO ddsys;
GRANT CREATE SEQUENCE TO ddsys;

-- =======================================
-- DataGrip

SELECT USER FROM DUAL;

CREATE TABLESPACE careconnect_data
DATAFILE 'careconnect_data.dbf'
SIZE 100M
AUTOEXTEND ON NEXT 50M;

CREATE TABLESPACE careconnect_index
DATAFILE 'careconnect_index.dbf'
SIZE 50M
AUTOEXTEND ON NEXT 25M;





SAVEPOINT start_transaction;

CREATE TABLE PACIENT (
    ID NUMBER(10) PRIMARY KEY,
    Nume VARCHAR2(50) NOT NULL,
    Prenume VARCHAR2(50) NOT NULL,
    CNP VARCHAR2(13) NOT NULL,
    Adresa VARCHAR2(200) NOT NULL,
    Telefon VARCHAR2(15) NOT NULL,
    Email VARCHAR2(100) NOT NULL,
    DataNasterii DATE NOT NULL,
    Sex CHAR(1) NOT NULL,
    GrupaSanguina VARCHAR2(3) NOT NULL,
    DataInregistrarii TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    
    -- Unique constraints
    CONSTRAINT UQ_PACIENT_CNP UNIQUE (CNP),
    CONSTRAINT UQ_PACIENT_TELEFON UNIQUE (Telefon),
    CONSTRAINT UQ_PACIENT_EMAIL UNIQUE (Email),
    
    -- Check constraints
    CONSTRAINT CHK_PACIENT_CNP CHECK (REGEXP_LIKE(CNP, '^[1-9][0-9]{12}$')),
    CONSTRAINT CHK_PACIENT_TELEFON CHECK (REGEXP_LIKE(Telefon, '^07[0-9]{8}$')),
    CONSTRAINT CHK_PACIENT_EMAIL CHECK (REGEXP_LIKE(Email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$')),
    CONSTRAINT CHK_PACIENT_SEX CHECK (Sex IN ('M', 'F')),
    CONSTRAINT CHK_PACIENT_GRUPA_SANGUINA CHECK (GrupaSanguina IN ('A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'))
);

CREATE TABLE SPECIALIZARE (
    ID NUMBER(10) PRIMARY KEY,
    Denumire VARCHAR2(100) NOT NULL,
    Descriere VARCHAR2(500) NOT NULL,
    Nivel VARCHAR2(50) NOT NULL,
    CodSpecializare VARCHAR2(20) NOT NULL,
    
    -- Unique constraint
    CONSTRAINT UQ_SPECIALIZARE_COD UNIQUE (CodSpecializare)
);

CREATE TABLE DEPARTAMENT (
    ID NUMBER(10) PRIMARY KEY,
    NumeDepartament VARCHAR2(100) NOT NULL,
    Locatie VARCHAR2(100) NOT NULL,
    IdSefDepartament NUMBER(10),
    BugetAlocat NUMBER(12,2) NOT NULL,
    NrPaturi NUMBER(4) NOT NULL,
    TelefonContact VARCHAR2(15) NOT NULL,
    
    -- Unique constraint
    CONSTRAINT UQ_DEPARTAMENT_TELEFON UNIQUE (TelefonContact),
    
    -- Check constraints
    CONSTRAINT CHK_DEPARTAMENT_BUGET CHECK (BugetAlocat > 0),
    CONSTRAINT CHK_DEPARTAMENT_PATURI CHECK (NrPaturi > 0),
    CONSTRAINT CHK_DEPARTAMENT_TELEFON CHECK (REGEXP_LIKE(TelefonContact, '^07[0-9]{8}$'))
);

CREATE TABLE MEDIC (
    ID NUMBER(10) PRIMARY KEY,
    Nume VARCHAR2(50) NOT NULL,
    Prenume VARCHAR2(50) NOT NULL,
    CNP VARCHAR2(13) NOT NULL,
    Telefon VARCHAR2(15) NOT NULL,
    Email VARCHAR2(100) NOT NULL,
    DataAngajare DATE NOT NULL,
    GradProfesional VARCHAR2(50) NOT NULL,
    NrLicenta VARCHAR2(20) NOT NULL,
    IdDepartament NUMBER(10) NOT NULL,

    -- Unique constraints
    CONSTRAINT UQ_MEDIC_CNP UNIQUE (CNP),
    CONSTRAINT UQ_MEDIC_TELEFON UNIQUE (Telefon),
    CONSTRAINT UQ_MEDIC_EMAIL UNIQUE (Email),
    CONSTRAINT UQ_MEDIC_NR_LICENTA UNIQUE (NrLicenta),

    -- Foreign key constraint
    CONSTRAINT FK_MEDIC_DEPARTAMENT FOREIGN KEY (IdDepartament)
        REFERENCES DEPARTAMENT(ID),

    -- Check constraints
    CONSTRAINT CHK_MEDIC_CNP CHECK (REGEXP_LIKE(CNP, '^[1-9][0-9]{12}$')),
    CONSTRAINT CHK_MEDIC_TELEFON CHECK (REGEXP_LIKE(Telefon, '^07[0-9]{8}$')),
    CONSTRAINT CHK_MEDIC_EMAIL CHECK (REGEXP_LIKE(Email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'))
);

ALTER TABLE DEPARTAMENT
ADD CONSTRAINT FK_DEPARTAMENT_SEF FOREIGN KEY (IdSefDepartament) 
    REFERENCES MEDIC(ID);

CREATE TABLE PROGRAMARE (
    ID NUMBER(10) PRIMARY KEY,
    IDPacient NUMBER(10) NOT NULL,
    IDMedic NUMBER(10) NOT NULL,
    DataProgramare DATE NOT NULL,
    OraProgramare VARCHAR2(5) NOT NULL,
    Status VARCHAR2(20) NOT NULL,
    MotivPrezentare VARCHAR2(500) NOT NULL,
    Observatii VARCHAR2(500),

    -- Foreign key constraints
    CONSTRAINT FK_PROGRAMARE_PACIENT FOREIGN KEY (IDPacient)
        REFERENCES PACIENT(ID),
    CONSTRAINT FK_PROGRAMARE_MEDIC FOREIGN KEY (IDMedic)
        REFERENCES MEDIC(ID),

    -- Check constraints
    CONSTRAINT CHK_PROGRAMARE_ORA CHECK (REGEXP_LIKE(OraProgramare, '^([0-1][0-9]|2[0-3]):[0-5][0-9]$')),
    CONSTRAINT CHK_PROGRAMARE_STATUS CHECK (Status IN ('Programata', 'Anulata', 'Realizata'))
);

CREATE TABLE ALERGIE (
    ID NUMBER(10) PRIMARY KEY,
    Denumire VARCHAR2(100) NOT NULL,
    Descriere VARCHAR2(500) NOT NULL,
    TipAlergie VARCHAR2(50) NOT NULL,
    CodMedical VARCHAR2(20) NOT NULL,
    
    -- Unique constraint
    CONSTRAINT UQ_ALERGIE_COD_MEDICAL UNIQUE (CodMedical)
);

CREATE TABLE MEDIC_SPECIALIZARE (
    IDMedic NUMBER(10),
    IDSpecializare NUMBER(10),
    DataObtinere DATE NOT NULL,
    CertificatNr VARCHAR2(20) NOT NULL,

    -- Primary key constraint (composite)
    CONSTRAINT PK_MEDIC_SPECIALIZARE PRIMARY KEY (IDMedic, IDSpecializare),

    -- Foreign key constraints
    CONSTRAINT FK_MEDIC_SPECIALIZARE_MEDIC FOREIGN KEY (IDMedic)
        REFERENCES MEDIC(ID),
    CONSTRAINT FK_MEDIC_SPECIALIZARE_SPECIALIZARE FOREIGN KEY (IDSpecializare)
        REFERENCES SPECIALIZARE(ID),

    -- Unique constraint
    CONSTRAINT UQ_MEDIC_SPECIALIZARE_CERTIFICAT UNIQUE (CertificatNr)
);

CREATE TABLE PACIENT_ALERGIE (
    IDPacient NUMBER(10),
    IDAlergie NUMBER(10),
    DataDiagnostic DATE NOT NULL,
    Observatii VARCHAR2(500),
    Severitate NUMBER(1) NOT NULL,
    
    -- Primary key constraint (composite)
    CONSTRAINT PK_PACIENT_ALERGIE PRIMARY KEY (IDPacient, IDAlergie),
    
    -- Foreign key constraints
    CONSTRAINT FK_PACIENT_ALERGIE_PACIENT FOREIGN KEY (IDPacient) 
        REFERENCES PACIENT(ID),
    CONSTRAINT FK_PACIENT_ALERGIE_ALERGIE FOREIGN KEY (IDAlergie) 
        REFERENCES ALERGIE(ID),
    
    -- Check constraint
    CONSTRAINT CHK_PACIENT_ALERGIE_SEVERITATE CHECK (Severitate IN (1, 2, 3, 4, 5))
);

CREATE TABLE CONSULTATIE (
    ID NUMBER(10) PRIMARY KEY,
    IDProgramare NUMBER(10) NOT NULL,
    DataConsultatie TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    Diagnostic VARCHAR2(500) NOT NULL,
    Observatii VARCHAR2(500),
    Recomandari VARCHAR2(500),
    Urgenta NUMBER(1) NOT NULL,

    -- Foreign key constraint
    CONSTRAINT FK_CONSULTATIE_PROGRAMARE FOREIGN KEY (IDProgramare)
        REFERENCES PROGRAMARE(ID),

    -- Check constraint
    CONSTRAINT CHK_CONSULTATIE_URGENTA CHECK (Urgenta IN (1, 2, 3, 4, 5))
);

CREATE TABLE RETETA (
    ID NUMBER(10) PRIMARY KEY,
    IDConsultatie NUMBER(10) NOT NULL,
    DataPrescriere TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DataExpirare TIMESTAMP NOT NULL,
    Observatii VARCHAR2(500),
    Status VARCHAR2(20) NOT NULL,
    CodUnic VARCHAR2(20) NOT NULL,
    
    -- Foreign key constraint
    CONSTRAINT FK_RETETA_CONSULTATIE FOREIGN KEY (IDConsultatie) 
        REFERENCES CONSULTATIE(ID),
    
    -- Unique constraint
    CONSTRAINT UQ_RETETA_COD_UNIC UNIQUE (CodUnic),
    
    -- Check constraints
    CONSTRAINT CHK_RETETA_DATA CHECK (DataExpirare > DataPrescriere),
    CONSTRAINT CHK_RETETA_STATUS CHECK (Status IN ('In asteptare', 'In curs', 'Finalizata'))
);

CREATE TABLE MEDICAMENT (
    ID NUMBER(10) PRIMARY KEY,
    Denumire VARCHAR2(100) NOT NULL,
    SubstantaActiva VARCHAR2(200) NOT NULL,
    Concentratie VARCHAR2(50) NOT NULL,
    FormaFarmaceutica VARCHAR2(50) NOT NULL,
    Producator VARCHAR2(100) NOT NULL,
    PretUnitar NUMBER(10,2) NOT NULL,
    StocDisponibil NUMBER(10) NOT NULL,
    NecesitaReteta NUMBER(1) NOT NULL,
    
    -- Check constraints
    CONSTRAINT CHK_MEDICAMENT_CONCENTRATIE CHECK (
        REGEXP_LIKE(Concentratie, '^[0-9][0-9].*$')
    ),
    CONSTRAINT CHK_MEDICAMENT_PRET CHECK (PretUnitar > 0),
    CONSTRAINT CHK_MEDICAMENT_STOC CHECK (StocDisponibil >= 0),
    CONSTRAINT CHK_MEDICAMENT_NECESITA_RETETA CHECK (NecesitaReteta IN (0, 1))
);

CREATE TABLE RETETA_MEDICAMENT (
    IDReteta NUMBER(10),
    IDMedicament NUMBER(10),
    Cantitate NUMBER(10) NOT NULL,
    Dozaj VARCHAR2(50) NOT NULL,
    DurataTratament NUMBER(10) NOT NULL,
    InstructiuniAdministrare VARCHAR2(500) NOT NULL,
    
    -- Primary key constraint (composite)
    CONSTRAINT PK_RETETA_MEDICAMENT PRIMARY KEY (IDReteta, IDMedicament),
    
    -- Foreign key constraints
    CONSTRAINT FK_RETETA_MEDICAMENT_RETETA FOREIGN KEY (IDReteta) 
        REFERENCES RETETA(ID),
    CONSTRAINT FK_RETETA_MEDICAMENT_MEDICAMENT FOREIGN KEY (IDMedicament) 
        REFERENCES MEDICAMENT(ID),
    
    -- Check constraints
    CONSTRAINT CHK_RETETA_MEDICAMENT_CANTITATE CHECK (Cantitate > 0),
    CONSTRAINT CHK_RETETA_MEDICAMENT_DURATA CHECK (DurataTratament > 0)
);

COMMIT;




SAVEPOINT start_transaction;

CREATE SEQUENCE SEQ_PACIENT_ID
    START WITH 1000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_MEDIC_ID
    START WITH 2000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_DEPARTAMENT_ID
    START WITH 3000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_PROGRAMARE_ID
    START WITH 4000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_CONSULTATIE_ID
    START WITH 5000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_RETETA_ID
    START WITH 6000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_MEDICAMENT_ID
    START WITH 7000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_ALERGIE_ID
    START WITH 8000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE SEQ_SPECIALIZARE_ID
    START WITH 9000001
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

COMMIT;






SAVEPOINT start_transaction;

CREATE OR REPLACE TRIGGER TRG_PACIENT_ID
    BEFORE INSERT ON PACIENT
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_PACIENT_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MEDIC_ID
    BEFORE INSERT ON MEDIC
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_MEDIC_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_PROGRAMARE_ID
    BEFORE INSERT ON PROGRAMARE
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_PROGRAMARE_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_CONSULTATIE_ID
    BEFORE INSERT ON CONSULTATIE
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_CONSULTATIE_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_RETETA_ID
    BEFORE INSERT ON RETETA
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_RETETA_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MEDICAMENT_ID
    BEFORE INSERT ON MEDICAMENT
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_MEDICAMENT_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_ALERGIE_ID
    BEFORE INSERT ON ALERGIE
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_ALERGIE_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_SPECIALIZARE_ID
    BEFORE INSERT ON SPECIALIZARE
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_SPECIALIZARE_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_DEPARTAMENT_ID
    BEFORE INSERT ON DEPARTAMENT
    FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        :NEW.ID := SEQ_DEPARTAMENT_ID.NEXTVAL;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_RETETA_UNIQUE_CONSULTATIE
    BEFORE INSERT OR UPDATE ON RETETA
    FOR EACH ROW
DECLARE
    v_count NUMBER;
BEGIN
    SELECT COUNT(*)
    INTO v_count
    FROM RETETA
    WHERE IDConsultatie = :NEW.IDConsultatie
    AND (:NEW.ID IS NULL OR ID != :NEW.ID);
    
    IF v_count > 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'O consultație poate avea o singură rețetă.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_CONSULTATIE_UNIQUE_PROGRAMARE
    BEFORE INSERT OR UPDATE ON CONSULTATIE
    FOR EACH ROW
DECLARE
    v_count NUMBER;
BEGIN
    SELECT COUNT(*)
    INTO v_count
    FROM CONSULTATIE
    WHERE IDProgramare = :NEW.IDProgramare
    AND (:NEW.ID IS NULL OR ID != :NEW.ID);
    
    IF v_count > 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'O programare poate avea o singură consultație.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_RETETA_MEDICAMENT_STOC
    BEFORE INSERT OR UPDATE ON RETETA_MEDICAMENT
    FOR EACH ROW
DECLARE
    v_stoc_disponibil NUMBER;
BEGIN
    SELECT StocDisponibil
    INTO v_stoc_disponibil
    FROM MEDICAMENT
    WHERE ID = :NEW.IDMedicament;
    
    IF :NEW.Cantitate > v_stoc_disponibil THEN
        RAISE_APPLICATION_ERROR(-20001, 'Cantitatea solicitată depășește stocul disponibil.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_RETETA_MEDICAMENT_UPDATE_STOC
    AFTER INSERT OR UPDATE OR DELETE ON RETETA_MEDICAMENT
    FOR EACH ROW
BEGIN
    IF INSERTING THEN
        UPDATE MEDICAMENT
        SET StocDisponibil = StocDisponibil - :NEW.Cantitate
        WHERE ID = :NEW.IDMedicament;
    ELSIF UPDATING THEN
        UPDATE MEDICAMENT
        SET StocDisponibil = StocDisponibil + :OLD.Cantitate - :NEW.Cantitate
        WHERE ID = :NEW.IDMedicament;
    ELSIF DELETING THEN
        UPDATE MEDICAMENT
        SET StocDisponibil = StocDisponibil + :OLD.Cantitate
        WHERE ID = :OLD.IDMedicament;
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_PACIENT_DATA_NASTERII
    BEFORE INSERT OR UPDATE OF DataNasterii ON PACIENT
    FOR EACH ROW
BEGIN
    IF :NEW.DataNasterii >= SYSDATE THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data nașterii trebuie să fie în trecut.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MEDIC_DATA_ANGAJARE
    BEFORE INSERT OR UPDATE OF DataAngajare ON MEDIC
    FOR EACH ROW
BEGIN
    IF :NEW.DataAngajare > TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data angajării nu poate fi în viitor.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_PROGRAMARE_DATA
    BEFORE INSERT OR UPDATE OF DataProgramare ON PROGRAMARE
    FOR EACH ROW
BEGIN
    IF :NEW.DataProgramare < TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data programării nu poate fi în trecut.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MEDIC_SPECIALIZARE_DATA
    BEFORE INSERT OR UPDATE OF DataObtinere ON MEDIC_SPECIALIZARE
    FOR EACH ROW
BEGIN
    IF :NEW.DataObtinere > TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data obținerii specializării nu poate fi în viitor.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_PACIENT_ALERGIE_DATA
    BEFORE INSERT OR UPDATE OF DataDiagnostic ON PACIENT_ALERGIE
    FOR EACH ROW
BEGIN
    IF :NEW.DataDiagnostic > TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data diagnosticului nu poate fi în viitor.');
    END IF;
END;

CREATE OR REPLACE TRIGGER TRG_CONSULTATIE_DATA
    BEFORE INSERT OR UPDATE OF DataConsultatie ON CONSULTATIE
    FOR EACH ROW
BEGIN
    IF TRUNC(:NEW.DataConsultatie) != TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data consultației trebuie să fie data curentă.');
    END IF;
END;

COMMIT;




SAVEPOINT start_transaction;

-- DEPARTAMENT (fără IdSefDepartament inițial)
INSERT INTO DEPARTAMENT (NumeDepartament, Locatie, BugetAlocat, NrPaturi, TelefonContact) VALUES
('Cardiologie', 'Etaj 2, Aripa Est', 500000.00, 20, '0755123456');
INSERT INTO DEPARTAMENT (NumeDepartament, Locatie, BugetAlocat, NrPaturi, TelefonContact) VALUES
('Neurologie', 'Etaj 3, Aripa Vest', 450000.00, 15, '0755123457');
INSERT INTO DEPARTAMENT (NumeDepartament, Locatie, BugetAlocat, NrPaturi, TelefonContact) VALUES
('Pediatrie', 'Etaj 1, Aripa Sud', 400000.00, 25, '0755123458');
INSERT INTO DEPARTAMENT (NumeDepartament, Locatie, BugetAlocat, NrPaturi, TelefonContact) VALUES
('Chirurgie', 'Etaj 4, Aripa Nord', 600000.00, 30, '0755123459');
INSERT INTO DEPARTAMENT (NumeDepartament, Locatie, BugetAlocat, NrPaturi, TelefonContact) VALUES
('Ortopedie', 'Etaj 2, Aripa Vest', 350000.00, 18, '0755123460');

-- MEDIC
INSERT INTO MEDIC (Nume, Prenume, CNP, Telefon, Email, DataAngajare, GradProfesional, NrLicenta, IdDepartament) VALUES
('Popescu', 'Ion', '1780101123456', '0722123456', 'ion.popescu@spital.ro', TO_DATE('2020-01-15', 'YYYY-MM-DD'), 'Primar', 'L123456', 3000001);
INSERT INTO MEDIC (Nume, Prenume, CNP, Telefon, Email, DataAngajare, GradProfesional, NrLicenta, IdDepartament) VALUES
('Ionescu', 'Maria', '2800202123456', '0722123457', 'maria.ionescu@spital.ro', TO_DATE('2019-03-20', 'YYYY-MM-DD'), 'Specialist', 'L123457', 3000002);
INSERT INTO MEDIC (Nume, Prenume, CNP, Telefon, Email, DataAngajare, GradProfesional, NrLicenta, IdDepartament) VALUES
('Georgescu', 'Ana', '2810303123456', '0722123458', 'ana.georgescu@spital.ro', TO_DATE('2021-06-10', 'YYYY-MM-DD'), 'Primar', 'L123458', 3000003);
INSERT INTO MEDIC (Nume, Prenume, CNP, Telefon, Email, DataAngajare, GradProfesional, NrLicenta, IdDepartament) VALUES
('Vasilescu', 'Dan', '1820404123456', '0722123459', 'dan.vasilescu@spital.ro', TO_DATE('2018-09-01', 'YYYY-MM-DD'), 'Specialist', 'L123459', 3000004);
INSERT INTO MEDIC (Nume, Prenume, CNP, Telefon, Email, DataAngajare, GradProfesional, NrLicenta, IdDepartament) VALUES
('Marinescu', 'Elena', '2830505123456', '0722123460', 'elena.marinescu@spital.ro', TO_DATE('2022-01-05', 'YYYY-MM-DD'), 'Rezident', 'L123460', 3000005);

-- Update DEPARTAMENT cu IdSefDepartament
UPDATE DEPARTAMENT SET IdSefDepartament = 2000001 WHERE ID = 3000001;
UPDATE DEPARTAMENT SET IdSefDepartament = 2000002 WHERE ID = 3000002;
UPDATE DEPARTAMENT SET IdSefDepartament = 2000003 WHERE ID = 3000003;
UPDATE DEPARTAMENT SET IdSefDepartament = 2000004 WHERE ID = 3000004;
UPDATE DEPARTAMENT SET IdSefDepartament = 2000005 WHERE ID = 3000005;

-- SPECIALIZARE
INSERT INTO SPECIALIZARE (Denumire, Descriere, Nivel, CodSpecializare) VALUES
('Cardiologie', 'Specializare în boli cardiovasculare', 'Avansat', 'CARD001');
INSERT INTO SPECIALIZARE (Denumire, Descriere, Nivel, CodSpecializare) VALUES
('Neurologie', 'Specializare în boli neurologice', 'Avansat', 'NEUR001');
INSERT INTO SPECIALIZARE (Denumire, Descriere, Nivel, CodSpecializare) VALUES
('Pediatrie', 'Specializare în îngrijirea copiilor', 'Mediu', 'PED001');
INSERT INTO SPECIALIZARE (Denumire, Descriere, Nivel, CodSpecializare) VALUES
('Chirurgie Generală', 'Specializare în intervenții chirurgicale', 'Avansat', 'CHIR001');
INSERT INTO SPECIALIZARE (Denumire, Descriere, Nivel, CodSpecializare) VALUES
('Ortopedie', 'Specializare în afecțiuni ale sistemului osteoarticular', 'Mediu', 'ORT001');

-- PACIENT
INSERT INTO PACIENT (Nume, Prenume, CNP, Adresa, Telefon, Email, DataNasterii, Sex, GrupaSanguina) VALUES
('Popa', 'Alexandru', '1900101123456', 'Str. Primaverii 10, București', '0733123456', 'alex.popa@email.com', TO_DATE('1990-01-01', 'YYYY-MM-DD'), 'M', 'A+');
INSERT INTO PACIENT (Nume, Prenume, CNP, Adresa, Telefon, Email, DataNasterii, Sex, GrupaSanguina) VALUES
('Dumitrescu', 'Elena', '2910202123456', 'Str. Florilor 20, București', '0733123457', 'elena.dumitrescu@email.com', TO_DATE('1991-02-02', 'YYYY-MM-DD'), 'F', 'O+');
INSERT INTO PACIENT (Nume, Prenume, CNP, Adresa, Telefon, Email, DataNasterii, Sex, GrupaSanguina) VALUES
('Stanescu', 'Mihai', '1920303123456', 'Str. Victoriei 30, București', '0733123458', 'mihai.stanescu@email.com', TO_DATE('1992-03-03', 'YYYY-MM-DD'), 'M', 'B+');
INSERT INTO PACIENT (Nume, Prenume, CNP, Adresa, Telefon, Email, DataNasterii, Sex, GrupaSanguina) VALUES
('Constantinescu', 'Maria', '2930404123456', 'Str. Unirii 40, București', '0733123459', 'maria.const@email.com', TO_DATE('1993-04-04', 'YYYY-MM-DD'), 'F', 'AB+');
INSERT INTO PACIENT (Nume, Prenume, CNP, Adresa, Telefon, Email, DataNasterii, Sex, GrupaSanguina) VALUES
('Diaconu', 'Andrei', '1940505123456', 'Str. Libertatii 50, București', '0733123460', 'andrei.diaconu@email.com', TO_DATE('1994-05-05', 'YYYY-MM-DD'), 'M', 'A-');

-- ALERGIE
INSERT INTO ALERGIE (Denumire, Descriere, TipAlergie, CodMedical) VALUES
('Penicilină', 'Alergie la antibiotice din grupa penicilinei', 'Medicamentoasă', 'AL001');
INSERT INTO ALERGIE (Denumire, Descriere, TipAlergie, CodMedical) VALUES
('Polen', 'Alergie sezonieră la polen', 'Sezonieră', 'AL002');
INSERT INTO ALERGIE (Denumire, Descriere, TipAlergie, CodMedical) VALUES
('Lactoza', 'Intoleranță la lactoză', 'Alimentară', 'AL003');
INSERT INTO ALERGIE (Denumire, Descriere, TipAlergie, CodMedical) VALUES
('Acarieni', 'Alergie la acarieni din praf', 'Respiratorie', 'AL004');
INSERT INTO ALERGIE (Denumire, Descriere, TipAlergie, CodMedical) VALUES
('Latex', 'Alergie la latex', 'Contact', 'AL005');

-- MEDICAMENT
INSERT INTO MEDICAMENT (Denumire, SubstantaActiva, Concentratie, FormaFarmaceutica, Producator, PretUnitar, StocDisponibil, NecesitaReteta) VALUES
('Augmentin', 'Amoxicilină', '875mg', 'Comprimate', 'GSK', 35.50, 100, 1);
INSERT INTO MEDICAMENT (Denumire, SubstantaActiva, Concentratie, FormaFarmaceutica, Producator, PretUnitar, StocDisponibil, NecesitaReteta) VALUES
('Nurofen', 'Ibuprofen', '400mg', 'Comprimate', 'Reckitt', 15.75, 200, 0);
INSERT INTO MEDICAMENT (Denumire, SubstantaActiva, Concentratie, FormaFarmaceutica, Producator, PretUnitar, StocDisponibil, NecesitaReteta) VALUES
('Paracetamol', 'Paracetamol', '500mg', 'Comprimate', 'Zentiva', 12.30, 300, 0);
INSERT INTO MEDICAMENT (Denumire, SubstantaActiva, Concentratie, FormaFarmaceutica, Producator, PretUnitar, StocDisponibil, NecesitaReteta) VALUES
('Ventolin', 'Salbutamol', '100mcg', 'Inhaler', 'GSK', 45.00, 50, 1);
INSERT INTO MEDICAMENT (Denumire, SubstantaActiva, Concentratie, FormaFarmaceutica, Producator, PretUnitar, StocDisponibil, NecesitaReteta) VALUES
('Omeprazol', 'Omeprazol', '20mg', 'Capsule', 'Terapia', 25.80, 150, 1);

-- PROGRAMARE
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000001, 2000001, TRUNC(SYSDATE), '09:00', 'Programata', 'Consult cardiologic', 'Prima vizită');
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000002, 2000002, TRUNC(SYSDATE), '10:30', 'Programata', 'Dureri de cap', 'Pacient cu antecedente');
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000003, 2000003, TRUNC(SYSDATE), '11:45', 'Programata', 'Control periodic', NULL);
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000004, 2000004, TRUNC(SYSDATE), '13:15', 'Programata', 'Evaluare preoperatorie', 'Urgent');
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000005, 2000005, TRUNC(SYSDATE), '14:30', 'Programata', 'Dureri articulare', NULL);
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000001, 2000002, TRUNC(SYSDATE+1), '09:15', 'Programata', 'Second opinion', NULL);
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000002, 2000003, TRUNC(SYSDATE+1), '10:45', 'Programata', 'Evaluare rezultate', NULL);
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000003, 2000004, TRUNC(SYSDATE+1), '12:00', 'Programata', 'Control postoperator', 'Follow-up');
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000004, 2000005, TRUNC(SYSDATE+1), '13:30', 'Programata', 'Consultație control', NULL);
INSERT INTO PROGRAMARE (IDPacient, IDMedic, DataProgramare, OraProgramare, Status, MotivPrezentare, Observatii) VALUES
(1000005, 2000001, TRUNC(SYSDATE+1), '15:00', 'Programata', 'Evaluare periodică', NULL);

-- CONSULTATIE (pentru programările din ziua curentă)
INSERT INTO CONSULTATIE (IDProgramare, Diagnostic, Observatii, Recomandari, Urgenta) VALUES
(4000001, 'Hipertensiune arterială', 'Tensiune 150/90', 'Regim alimentar strict', 3);
INSERT INTO CONSULTATIE (IDProgramare, Diagnostic, Observatii, Recomandari, Urgenta) VALUES
(4000002, 'Migrenă cronică', 'Dureri frecvente', 'Evitarea factorilor declanșatori', 2);
INSERT INTO CONSULTATIE (IDProgramare, Diagnostic, Observatii, Recomandari, Urgenta) VALUES
(4000003, 'Stare generală bună', 'Control de rutină', 'Menținerea stilului de viață actual', 1);
INSERT INTO CONSULTATIE (IDProgramare, Diagnostic, Observatii, Recomandari, Urgenta) VALUES
(4000004, 'Hernie de disc', 'Necesită intervenție', 'Pregătire preoperatorie', 4);
INSERT INTO CONSULTATIE (IDProgramare, Diagnostic, Observatii, Recomandari, Urgenta) VALUES
(4000005, 'Artroză genunchi', 'Dureri la mers', 'Fizioterapie', 2);

-- RETETA (pentru consultațiile efectuate)
INSERT INTO RETETA (IDConsultatie, DataExpirare, Observatii, Status, CodUnic) VALUES
(5000001, SYSDATE + 30, 'A se administra dimineața', 'In asteptare', 'RX001');
INSERT INTO RETETA (IDConsultatie, DataExpirare, Observatii, Status, CodUnic) VALUES
(5000002, SYSDATE + 30, 'A se administra la nevoie', 'In asteptare', 'RX002');
INSERT INTO RETETA (IDConsultatie, DataExpirare, Observatii, Status, CodUnic) VALUES
(5000003, SYSDATE + 30, NULL, 'In asteptare', 'RX003');
INSERT INTO RETETA (IDConsultatie, DataExpirare, Observatii, Status, CodUnic) VALUES
(5000004, SYSDATE + 30, 'Tratament preoperator', 'In asteptare', 'RX004');
INSERT INTO RETETA (IDConsultatie, DataExpirare, Observatii, Status, CodUnic) VALUES
(5000005, SYSDATE + 30, 'Tratament antiinflamator', 'In asteptare', 'RX005');

-- Tabele asociative (10 înregistrări pentru fiecare)

-- MEDIC_SPECIALIZARE
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000001, 9000001, TO_DATE('2019-01-15', 'YYYY-MM-DD'), 'CERT001');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000001, 9000002, TO_DATE('2019-06-20', 'YYYY-MM-DD'), 'CERT002');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000002, 9000002, TO_DATE('2018-03-10', 'YYYY-MM-DD'), 'CERT003');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000002, 9000003, TO_DATE('2018-09-15', 'YYYY-MM-DD'), 'CERT004');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000003, 9000003, TO_DATE('2020-02-28', 'YYYY-MM-DD'), 'CERT005');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000003, 9000004, TO_DATE('2020-08-15', 'YYYY-MM-DD'), 'CERT006');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000004, 9000004, TO_DATE('2017-11-20', 'YYYY-MM-DD'), 'CERT007');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000004, 9000005, TO_DATE('2018-04-25', 'YYYY-MM-DD'), 'CERT008');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000005, 9000005, TO_DATE('2021-07-30', 'YYYY-MM-DD'), 'CERT009');
INSERT INTO MEDIC_SPECIALIZARE (IDMedic, IDSpecializare, DataObtinere, CertificatNr) VALUES
(2000005, 9000001, TO_DATE('2021-12-15', 'YYYY-MM-DD'), 'CERT010');

-- PACIENT_ALERGIE
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000001, 8000001, TO_DATE('2020-01-15', 'YYYY-MM-DD'), 'Reacție severă la penicilină', 5);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000001, 8000002, TO_DATE('2020-03-20', 'YYYY-MM-DD'), 'Rinită alergică sezonieră', 3);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000002, 8000002, TO_DATE('2019-05-10', 'YYYY-MM-DD'), 'Manifestări moderate', 2);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000002, 8000003, TO_DATE('2019-08-15', 'YYYY-MM-DD'), 'Intoleranță confirmată', 4);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000003, 8000003, TO_DATE('2021-02-28', 'YYYY-MM-DD'), 'Simptome ușoare', 1);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000003, 8000004, TO_DATE('2021-06-15', 'YYYY-MM-DD'), 'Necesită tratament continuu', 3);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000004, 8000004, TO_DATE('2018-11-20', 'YYYY-MM-DD'), 'Agravare în sezonul rece', 4);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000004, 8000005, TO_DATE('2019-04-25', 'YYYY-MM-DD'), 'Reacție moderată', 2);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000005, 8000005, TO_DATE('2022-07-30', 'YYYY-MM-DD'), 'Sub observație', 3);
INSERT INTO PACIENT_ALERGIE (IDPacient, IDAlergie, DataDiagnostic, Observatii, Severitate) VALUES
(1000005, 8000001, TO_DATE('2022-12-15', 'YYYY-MM-DD'), 'Necesită atenție sporită', 4);

-- RETETA_MEDICAMENT
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000001, 7000001, 1, '1cp x 2/zi', 10, 'Dimineața și seara, după masă');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000001, 7000002, 2, '1cp la 8 ore', 7, 'La nevoie, maxim 3 pe zi');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000002, 7000003, 3, '1cp la 6 ore', 5, 'În caz de durere');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000002, 7000004, 1, '2 pufuri la nevoie', 30, 'În caz de criză');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000003, 7000005, 2, '1cp/zi', 14, 'Dimineața, înainte de masă');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000003, 7000001, 1, '1cp x 2/zi', 7, 'Dimineața și seara');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000004, 7000002, 3, '1cp la 12 ore', 10, 'La durere');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000004, 7000003, 2, '1cp la 8 ore', 5, 'După masă');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000005, 7000004, 1, '2 pufuri de 3 ori/zi', 30, 'La nevoie');
INSERT INTO RETETA_MEDICAMENT (IDReteta, IDMedicament, Cantitate, Dozaj, DurataTratament, InstructiuniAdministrare) VALUES
(6000005, 7000005, 1, '1cp seara', 14, 'Înainte de culcare');

COMMIT;




-- 1. Drop trigger
DROP TRIGGER trg_monitorizare_schema;

-- 2. Drop tabelul MESAJE 
DROP TABLE MESAJE;

-- 3. Drop package
DROP PACKAGE management_spital;

-- 4. Drop restul trigger-urilor
DROP TRIGGER TRG_PACIENT_ID;
DROP TRIGGER TRG_MEDIC_ID;
DROP TRIGGER TRG_PROGRAMARE_ID;
DROP TRIGGER TRG_CONSULTATIE_ID;
DROP TRIGGER TRG_RETETA_ID;
DROP TRIGGER TRG_MEDICAMENT_ID;
DROP TRIGGER TRG_ALERGIE_ID;
DROP TRIGGER TRG_SPECIALIZARE_ID;
DROP TRIGGER TRG_DEPARTAMENT_ID;
DROP TRIGGER TRG_RETETA_UNIQUE_CONSULTATIE;
DROP TRIGGER TRG_CONSULTATIE_UNIQUE_PROGRAMARE;
DROP TRIGGER TRG_RETETA_MEDICAMENT_STOC;
DROP TRIGGER TRG_RETETA_MEDICAMENT_UPDATE_STOC;
DROP TRIGGER TRG_PACIENT_DATA_NASTERII;
DROP TRIGGER TRG_MEDIC_DATA_ANGAJARE;
DROP TRIGGER TRG_PROGRAMARE_DATA;
DROP TRIGGER TRG_MEDIC_SPECIALIZARE_DATA;
DROP TRIGGER TRG_PACIENT_ALERGIE_DATA;
DROP TRIGGER TRG_CONSULTATIE_DATA;

-- 5. Drop tabele asociative
DROP TABLE RETETA_MEDICAMENT;
DROP TABLE PACIENT_ALERGIE;
DROP TABLE MEDIC_SPECIALIZARE;

-- 6. Drop tabele cu foreign keys
DROP TABLE RETETA;
DROP TABLE CONSULTATIE;
DROP TABLE PROGRAMARE;

-- 7. Drop tabele principale
ALTER TABLE DEPARTAMENT DROP CONSTRAINT FK_DEPARTAMENT_SEF;
DROP TABLE MEDIC;
DROP TABLE DEPARTAMENT;
DROP TABLE PACIENT;
DROP TABLE SPECIALIZARE;
DROP TABLE ALERGIE;
DROP TABLE MEDICAMENT;

-- 8. Drop secvente
DROP SEQUENCE SEQ_PACIENT_ID;
DROP SEQUENCE SEQ_MEDIC_ID;
DROP SEQUENCE SEQ_DEPARTAMENT_ID;
DROP SEQUENCE SEQ_PROGRAMARE_ID;
DROP SEQUENCE SEQ_CONSULTATIE_ID;
DROP SEQUENCE SEQ_RETETA_ID;
DROP SEQUENCE SEQ_MEDICAMENT_ID;
DROP SEQUENCE SEQ_ALERGIE_ID;
DROP SEQUENCE SEQ_SPECIALIZARE_ID;
DROP SEQUENCE SEQ_MESAJE;





